# Αυτόματο Script Καθαρισμού Ατελειών (Artifacts) από Δεδομένα EEG

## Περιγραφή

Αυτό το script επεξεργάζεται αρχεία EEG σε μορφή .edf από τη συσκευή Emotiv Insight 2 και εφαρμόζει τη μέθοδο Ανάλυσης Ανεξάρτητων Συνιστωσών (ICA) για τον αυτόματο εντοπισμό και την αφαίρεση ατελειών που προέρχονται από βλεφαρισμούς (EOG artifacts).

## Χαρακτηριστικά

- ✅ Φόρτωση .edf αρχείων από Emotiv Insight 2
- ✅ Αυτόματο φιλτράρισμα σήματος (1-40 Hz)
- ✅ ICA ανάλυση για εντοπισμό artifacts
- ✅ Αυτόματος εντοπισμός EOG artifacts με πολλαπλές μεθόδους
- ✅ Αφαίρεση artifacts και καθαρισμός σήματος
- ✅ Εξαγωγή καθαρών δεδομένων σε .edf μορφή
- ✅ Στατιστική ανάλυση και αξιολόγηση αποτελεσμάτων
- ✅ Οπτικοποίηση σύγκρισης πριν/μετά τον καθαρισμό

## Απαιτήσεις Συστήματος

### Python Packages
Εγκαταστήστε τις απαραίτητες βιβλιοθήκες:

```bash
pip install -r requirements.txt
```

### Εγκατεστημένα Packages:
- `mne>=1.4.0` - Για επεξεργασία EEG δεδομένων
- `pyEDFlib>=0.1.30` - Για ανάγνωση/εγγραφή .edf αρχείων (ή εναλλακτικά χρησιμοποιείται το MNE)
- `pandas>=1.3.0` - Για χειρισμό δεδομένων
- `scikit-learn>=1.0.0` - Για ICA και μηχανική μάθηση
- `numpy>=1.21.0` - Για αριθμητικούς υπολογισμούς
- `scipy>=1.7.0` - Για στατιστικούς υπολογισμούς
- `matplotlib>=3.5.0` - Για οπτικοποιήσεις
- `PyQt6>=6.5.0` - Για το γραφικό περιβάλλον χρήστη

### Σημαντικές Σημειώσεις για την Εγκατάσταση:
- Το αρχείο `requirements.txt` περιέχει όλες τις απαραίτητες εξαρτήσεις
- Εάν αντιμετωπίζετε προβλήματα με imports, βεβαιωθείτε ότι έχετε εγκαταστήσει όλα τα packages από το requirements.txt
- Για χρήση σε περιβάλλον χωρίς οθόνη (headless), θα χρειαστείτε display server ή virtual display
- `scikit-learn>=1.0.0` - Για ICA υλοποίηση
- `numpy>=1.21.0` - Για αριθμητικούς υπολογισμούς
- `matplotlib>=3.5.0` - Για οπτικοποίηση

## Δομή Αρχείων

```
train_noise/
├── data.edf                          # Αρχικό αρχείο EEG (είσοδος)
├── data_clean.edf                    # Καθαρό αρχείο EEG (έξοδος)
├── eeg_artifact_cleaner.py           # Κύριο script καθαρισμού
├── visualize_results.py              # Script οπτικοποίησης
├── requirements.txt                  # Απαιτήσεις Python
├── artifact_cleaning_comparison.png  # Γράφημα σύγκρισης σημάτων
└── artifact_cleaning_statistics.png  # Γράφημα στατιστικών
```

## Χρήση

### 1. Βασική Χρήση

```bash
python3 eeg_artifact_cleaner.py
```

Το script θα:
1. Φορτώσει το αρχείο `data.edf`
2. Εφαρμόσει φιλτράρισμα 1-40 Hz
3. Εκτελέσει ICA ανάλυση
4. Εντοπίσει και αφαιρέσει EOG artifacts
5. Αποθηκεύσει το καθαρό σήμα ως `data_clean.edf`

### 2. Οπτικοποίηση Αποτελεσμάτων

```bash
python3 visualize_results.py
```

Δημιουργεί γραφήματα σύγκρισης και στατιστικών για την αξιολόγηση της αποτελεσματικότητας του καθαρισμού.

## Αλγόριθμος Καθαρισμού

### 1. Προ-επεξεργασία
- Φόρτωση και επιλογή EEG καναλιών: AF3, T7, Pz, T8, AF4
- Εφαρμογή band-pass φίλτρου 1-40 Hz

### 2. ICA Ανάλυση
- Εκπαίδευση ICA μοντέλου με 5 συνιστώσες (FastICA)
- Ανάλυση ανεξάρτητων συνιστωσών

### 3. Εντοπισμός Artifacts
Το script χρησιμοποιεί πολλαπλές μεθόδους για τον εντοπισμό EOG artifacts:

1. **Αυτόματος εντοπισμός με MNE**: Χρήση `find_bads_eog()` με κανάλια AF3/AF4
2. **Στατιστική ανάλυση**: Ανάλυση διακύμανσης, κυρτότητας και εύρους σήματος
3. **Fallback μέθοδος**: Επιλογή συνιστώσας με μεγαλύτερη διακύμανση

### 4. Κριτήρια Artifact Detection
- Υψηλή διακύμανση (>2x median)
- Κυρτότητα >5.0 
- Εύρος σήματος >1.5x median

## Αποτελέσματα

Το script παρέχει αναλυτικά στατιστικά:

```
Τυπική απόκλιση ανά κανάλι:
  AF3: 45.19 μV -> 24.97 μV (μείωση: 44.7%)
  T7: 35.60 μV -> 13.45 μV (μείωση: 62.2%)
  Pz: 133.07 μV -> 6.12 μV (μείωση: 95.4%)
  T8: 39.41 μV -> 12.34 μV (μείωση: 68.7%)
  AF4: 42.42 μV -> 22.02 μV (μείωση: 48.1%)

Μέση μείωση θορύβου: 63.8%
```

## Κριτήρια Αποδοχής

- ✅ **Εκτέλεση χωρίς σφάλματα**: Το script εκτελείται επιτυχώς
- ✅ **Εντοπισμός artifacts**: Αναγνωρίζει τουλάχιστον μία συνιστώσα ως EOG artifact
- ✅ **Δημιουργία .edf αρχείου**: Παράγει επιτυχώς το αρχείο εξόδου
- ✅ **Μείωση artifacts**: Παρατηρείται σαφής μείωση θορύβου στα δεδομένα

## Τεχνικές Λεπτομέρειες

### Παράμετροι ICA
- **Αλγόριθμος**: FastICA
- **Συνιστώσες**: 5 (ίσες με τον αριθμό EEG καναλιών)
- **Μέγιστες επαναλήψεις**: 200
- **Random state**: 42 (για αναπαραγώγιμα αποτελέσματα)

### Φιλτράρισμα
- **High-pass**: 1.0 Hz (αφαίρεση DC offset και low-frequency drift)
- **Low-pass**: 40.0 Hz (αφαίρεση high-frequency noise)

### Εξαγωγή Δεδομένων
- **Μορφή**: EDF (European Data Format)
- **Μετατροπή**: Από Volts σε microVolts (μV)
- **Sampling rate**: Διατήρηση αρχικής συχνότητας (128 Hz)

## Αντιμετώπιση Προβλημάτων

### Συνήθη Προβλήματα

1. **Σφάλμα φόρτωσης αρχείου**
   - Βεβαιωθείτε ότι το `data.edf` υπάρχει στον φάκελο
   - Ελέγξτε ότι το αρχείο δεν είναι κατεστραμμένο

2. **Σφάλμα εγκατάστασης packages**
   ```bash
   pip install --upgrade pip
   pip install -r requirements.txt
   ```

3. **Προβλήματα με την οπτικοποίηση**
   - Σε headless συστήματα, χρησιμοποιήστε: `matplotlib.use('Agg')`

4. **Σφάλμα "CheckButtons object has no attribute 'rectangles'"**
   - Αυτό το σφάλμα εμφανίζεται σε νεότερες εκδόσεις matplotlib (>= 3.7)
   - Το script έχει ενσωματωμένη συμβατότητα που λύνει αυτό το θέμα αυτόματα
   - Εάν εξακολουθείτε να αντιμετωπίζετε προβλήματα, ενημερώστε τα dependencies:
   ```bash
   pip install --upgrade matplotlib mne
   ```

## Συμβατότητα

- **Python**: 3.8+
- **Συσκευές EEG**: Emotiv Insight 2
- **Λειτουργικά Συστήματα**: Windows, macOS, Linux
- **Μορφές αρχείων**: .edf (είσοδος και έξοδος)

## Συγγραφέας

Δημιουργήθηκε για το Mind-Wandering research project.

## Άδεια Χρήσης

Αυτό το script είναι διαθέσιμο για ερευνητική χρήση.